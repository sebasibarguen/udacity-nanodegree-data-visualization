---
title: "Github's Timeline"
output: html_document
---

## Abstract
This short analysis looks at how public collaboration in developing software happens in Github. The study focuses on *PushEvents* which are the atomic blocks of contribution. The primary interest is to better understand 

## Introduction

*["GitHub is the best place to share code with friends, co-workers, classmates, and complete strangers. Over seven million people use GitHub to build amazing things together."](https://github.com/about)*

It is now the biggest code host and is huge in the open-source community. The new workflows and collaborations models have changed the ease, simplicity and automation of creating software.

In this study we are interested in the public projects hosting, specifically *PushEvent*. Github's API gives us all the public events happening in their [timeline](https://developer.github.com/v3/activity/events/). This study uses the Github Archive dataset, whic is a compilation of the Github timeline. The data format is a JSON stream, which is given in a Gzip file and is aggregated in an hourly basis.

Given the size of the dataset, here we will focus on just one day, November 1, 2014. Arguably *PushEvent* represents the most important event when analyzing collaboration. A *PushEvent* in simple terms is a code contribution to a project, and it is comprised of *git commits*.

## Preparing the data
As mentioned before, the data from Github Archive is a JSON stream of all Githubs public events. There are [25 different types of events](https://developer.github.com/v3/activity/events/types/), ranging from *DownloadEvent*, *IssueEvent* to *StatusEvent*. 


After having problems preparing the data inside R, I decided to implement a small python script to do the job instead. The scripts purpose is to download the 24 files for November 1, look only for the *PushEvent* and write that to a new file. The output file is 735MB, 

```{python}
import gzip
import urllib
import json

# List of filenames for 24 hours of November 1, 2014.
filenames = ["2014-11-01-" + str(i) + ".json.gz" for i in range(1,24)]

# Open output file
with open('data/2014-11-01-PushEvent.json', 'wb') as f:

    # Download files
    for filename in filenames:
        url = base_url + filename

        print "Starting to download: " + url
        f_name, f_headers = urllib.urlretrieve(url)
        print "Finished download."

        with gzip.open(f_name) as g:
            content = g.readlines()

            for line in content:
                event = json.loads(line)

                if event["type"] == "PushEvent":
                    f.write(line)
        print "Finished writing: " + filename
```

Read the data and pass it to a dataframe.

```{r}
library(jsonlite)

github = stream_in(file("data/2014-11-01-PushEvent.json"), verbose=FALSE)

df = data.frame(language=github$repository$language, payloadSize=github$payload$size, user=github$actor_attributes$email, location=github$actor_attributes$location, url=github$repository$url,date=github$repository$created_at, pushDate = github$created_at, forked = github$repository$forked, forks = github$repository$forks, lat=github$actor_attributes$lat, lon=github$actor_attributes$lon, country=df$actor_attributes$country)

rm(github)

```

## Overview Github Push Events
```{r}
library(ggplot2)

qplot(github$payload$size, geom='histogram', xlim=c(0,25),  binwidth=1)
```

### Hour of day
```{r}
df$hourOfDay = lapply(df$pushDate, strptime, format="%Y-%m-%dT%H:%M:%S")
df$hourOfDay = lapply(df$hourOfDay, strftime, format="%H")


df$pushHour = sapply(df$hourOfDay, function(x) { return( x[[1]] ) })

qplot(df$pushHour, geom='histogram', binwidth=1)
```

### Push contributions date vs repository date

### Programming languages

## Mapping contributions

1. What countries are most active?
2. How much cross-country contribution occurs?
3. 

```{r}
library(plyr)
library(maps)

glocation = ddply(df, c("location"), summarise, N = length(payloadSize), total=sum(payloadSize, na.rm=TRUE))

map = map_data("world")
glocation$location = tolower(glocation$location)
```



